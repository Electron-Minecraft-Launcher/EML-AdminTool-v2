# # # # # # # # # # # # # # # # # # # # # # # # # # # #
#               DEVELOPMENT ENVIRONMENT               #
#                                                     #
# This file is used to run the application in a       #
# development environment.                            #
# It enables hot-reloading of the application, and    #
# gives an access to the database through phpMyAdmin. #
#                                                     #
# To run the application in a production environment, #
# you should use the docker-compose.prod.yml file     #
# with an existing Docker image.                      #
#                                                     #
# Warning:                                            #
#  - You may sometimes need to restart the container  #
#    when you create a new file.                      #
#  - You may need to delete and rebuild the "web"     #
#    container and image when you install a new       #
#    dependency or update dependencies.               #
# # # # # # # # # # # # # # # # # # # # # # # # # # # #

name: eml_admintool_dev

services:
  web:
    build:
      context: ../
      dockerfile: ./docker/Dockerfile.dev
    environment:
      NODE_ENV: 'development'
    volumes:
      - ../.svelte-kit:/app/.svelte-kit
      - ../static:/app/static
      - ../node_modules/.prisma:/app/node_modules/.prisma
      - ../prisma:/app/prisma
      - ../src:/app/src
      - ../.env:/app/.env
      - ../LICENSE:/app/LICENSE
      - ../package.json:/app/package.json
      - ../svelte.config.js:/app/svelte.config.js
      - ../tsconfig.json:/app/tsconfig.json
      - ../vite.config.ts:/app/vite.config.ts
      - files:/app/files
      - loader:/app/loader
      - /var/run/docker.sock:/var/run/docker.sock
    ports:
      - '5173:5173'
    depends_on:
      - db
    restart: always
  db:
    image: postgres:latest
    environment:
      POSTGRES_USER: eml
      POSTGRES_PASSWORD: eml
      POSTGRES_DB: eml_admintool
    volumes:
      - db-data:/var/lib/postgresql/data
    ports:
      - '5432:5432'
  
  pga:
    image: dpage/pgadmin4
    environment:
      PGADMIN_DEFAULT_EMAIL: admintool@eml.com
      PGADMIN_DEFAULT_PASSWORD: eml
    ports:
      - '8080:80'
    depends_on:
      - db

volumes:
  db-data:
  files:
  loader:
